#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define STR_LTH 26                                      //makes the length 25

char decrypt(char *wrd, int key);                       //function for encrypting 

int main()
{
    char wrd[STR_LTH];                                  //declares string
    int key=0;
    FILE *EncryptedText;                                //sets a pointer to the file TextToEncrypt
    EncryptedText=fopen("EncryptedText.txt","r");       //opens and reads the file
    FILE *DecryptedText;
    DecryptedText=fopen("DecryptedText.txt","w");
    
    while(!feof(EncryptedText))
        {
            fscanf(EncryptedText,"%s",wrd); 
            if(wrd[0]==wrd[0] && (wrd[1]==wrd[0]-12 || wrd[1]==wrd[0]+26-12) && (wrd[2]==wrd[0]-15 || wrd[2]==wrd[0]+26-15) && wrd[3]=='\0')
            {
                if(wrd[0]<84)
                {
                    key=wrd[0]+26-84;
                }
                else if(wrd[0]>84)
                {
                    key=wrd[0]-84;
                }
                printf("The key is %d\n\n",key);
                break;
            }
            else if(wrd[0]==wrd[0] && (wrd[1]==wrd[0]+13 || wrd[1]==wrd[0]+26+13) && (wrd[2]==wrd[0]+3 || wrd[2]==wrd[0]+26+3) && wrd[3]=='\0')
            {
                if(wrd[0]<65)
                {
                    key=wrd[0]+26-65;
                }
                else if(wrd[0]>65)
                {
                    key=wrd[0]-65;
                }
                printf("The key is %d\n\n",key);
                break;
            }
            else if(wrd[0]==wrd[0] && (wrd[1]==wrd[0]+3 || wrd[1]==wrd[0]+26+3) && wrd[2]=='\0')
            {
                if(wrd[0]<66)
                {
                    key=wrd[0]+26-66;
                }
                else if(wrd[0]>66)
                {
                    key=wrd[0]-66;
                }
                printf("The key is %d\n\n",key);
                break;
            }
            else if(wrd[0]==wrd[0] && (wrd[1]==wrd[0]-5 || wrd[1]==wrd[0]+26-5) && wrd[2]=='\0')
            {
                if(wrd[0]<84)
                {
                    key=wrd[0]+26-84;
                }
                else if(wrd[0]>84)
                {
                    key=wrd[0]-84;
                }
                printf("The key is %d\n\n",key);
                break;
            }
        }
    
        fclose(EncryptedText);                              //closes file
        fclose(DecryptedText); 
        EncryptedText=fopen("EncryptedText.txt","r");
        DecryptedText=fopen("DecryptedText.txt","w");
        
    while(!feof(EncryptedText))                         // makes a loop so that while the file is still going
    {
        fscanf(EncryptedText,"%s",wrd);                 //reads a word in the file then stores it in a string
        decrypt(wrd, key);                             //calls function to that string       
        printf("%s ",wrd);                              //prints the encrypted text to the console
        fprintf(DecryptedText, "%s ",wrd);              //prints encrypted text to the file EncryptedText
    }
    printf("\n");                                       //prints new line to the console
    fprintf(DecryptedText, "\n");                       //prints new line to file
    fclose(EncryptedText);                              //closes file
    fclose(DecryptedText);                              //closes file
    

  return 0;
}

char decrypt(char *wrd, int key)
{
    
    int i=0;                                            //declares i as an int
    for(i = 0;i < STR_LTH;i++)                          //for thr length of the string 
    {
        if(wrd[i] == '\0')                              //if the word ends return 0
        {
            return 0;
            goto label;
        }
        else if(wrd[i]<65 || wrd[i]>90)
        {
            return 0;
            goto label;
        }
        
        wrd[i]=wrd[i]-key;                                //shifts char value up by an amount
        
        if(wrd[i]>90)
        {
            wrd[i]=wrd[i]-26;
        }
        else if(wrd[i]<65)
        {
            wrd[i]=wrd[i]+26;
        }
    }
    label:
    return 0;
}
